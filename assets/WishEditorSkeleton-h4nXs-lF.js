var _=Object.defineProperty,T=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var z=(s,n,t)=>n in s?_(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t,u=(s,n)=>{for(var t in n||(n={}))E.call(n,t)&&z(s,t,n[t]);if(L)for(var t of L(n))V.call(n,t)&&z(s,t,n[t]);return s},p=(s,n)=>T(s,A(n));var w=(s,n)=>{var t={};for(var a in s)E.call(s,a)&&n.indexOf(a)<0&&(t[a]=s[a]);if(s!=null&&L)for(var a of L(s))n.indexOf(a)<0&&V.call(s,a)&&(t[a]=s[a]);return t};var R=(s,n,t)=>new Promise((a,r)=>{var c=o=>{try{d(t.next(o))}catch(i){r(i)}},x=o=>{try{d(t.throw(o))}catch(i){r(i)}},d=o=>o.done?a(o.value):Promise.resolve(o.value).then(c,x);d((t=t.apply(s,n)).next())});import{y as B,j as e,aO as P,z as I,B as M,r as j,C as H,bl as $,bm as G,aA as q,b4 as J,b5 as X,b6 as D,b7 as f,b8 as h,b9 as v,ba as U,bb as C,bc as F,bh as Y,bd as K,bn as Q,v as Z,w as ee,o as se,q as te,aN as ae,_ as ne,g as re,bo as le,bp as oe}from"./index-CMoUaIAy.js";import{i as ce,u as ie,C as de,a as me}from"./uploadToStorage-Do5hfno0.js";import{c as xe}from"./schemas-DolQb7Cl.js";import{d as ue,C as pe,b as je,N as ge,S as g}from"./react-number-format.es-DRwriqXX.js";import{W as fe}from"./WishLayout-DDKakPIl.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],be=B("arrow-left",he);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M10.3 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10l-3.1-3.1a2 2 0 0 0-2.814.014L6 21",key:"9csbqa"}],["path",{d:"m14 19 3 3v-5.5",key:"9ldu5r"}],["path",{d:"m17 22 3-3",key:"1nkfve"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]],ve=B("image-down",Ne);function ye({onSelect:s,selectedValue:n,className:t}){const{wishlists:a,isLoading:r,error:c,optionValue:x,options:d}=ue(n);return e.jsx(P,{options:d,onSelect:o=>{const i=a==null?void 0:a.find(l=>l.$id===o);s(o,i!=null?i:null)},renderSelected:o=>e.jsxs("span",{className:"inline-flex items-center gap-2",children:[o==null?void 0:o.icon,o==null?void 0:o.label]}),selectedValue:x,title:"Выберите список",isLoading:r,error:c,triggerClassName:t})}function we(s){var r;const n=s.wishlistId==="none"?null:s.wishlistId,t=s.price===0||!s.price?null:s.price,a=s.shopURL===""?null:s.shopURL;return p(u({},s),{price:t,shopURL:a,wishlistId:n,wishlist:s.wishlist,imageURL:(r=s.imageURL)!=null?r:null})}function Se(t){var a=t,{children:s}=a,n=w(a,["children"]);const r=I();function c(){return r(-1)}return e.jsx(e.Fragment,{children:e.jsx(M,p(u({onClick:c},n),{size:"lg",children:s}))})}function ke({onValueChange:s,value:n}){const t=j.useMemo(()=>pe.map(a=>({value:a.abbr,label:a.title,icon:a.icon})),[]);return e.jsx(P,{selectedValue:n,onSelect:s,options:t,renderSelected:a=>e.jsxs("span",{className:"flex justify-between items-center gap-1",children:[a==null?void 0:a.icon,e.jsx(H,{className:"md:hidden size-3"})]}),renderOption:a=>e.jsxs("span",{className:"flex justify-between items-center gap-2 w-full",children:[a.label,e.jsx("span",{className:"text-muted-foreground",children:a.icon})]}),triggerClassName:"bg-muted/60 px-3 rounded-sm h-9 text-muted-foreground",contentClassName:"md:w-3xs",title:"Валюта"})}function Re({priority:s,setPriority:n}){const t=new Map([[0,"Было бы неплохо"],[1,"Хочу, но может подождать"],[2,"Очень нужно!"]]);return e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-2.5",children:[e.jsx("div",{className:"bg-secondary px-3.5 pt-3 pb-2.5 rounded-md w-fit",children:e.jsx($,{value:s+1,onValueChange:a=>n(a-1),children:Array.from({length:3}).map((a,r)=>e.jsx(G,{icon:e.jsx(q,{}),size:16,className:"text-primary"},r))})}),e.jsx("p",{className:"text-muted-foreground text-sm",children:t.get(s)})]})}function Fe({wish:s,onSubmit:n,setBlockNavigate:t}){const a=je(),r=J({resolver:X(xe),mode:"onChange",defaultValues:{title:(s==null?void 0:s.title)||"",description:(s==null?void 0:s.description)||"",shopURL:(s==null?void 0:s.shopURL)||"",price:(s==null?void 0:s.price)||null,currency:(s==null?void 0:s.currency)||"RUB",wishlistId:(s==null?void 0:s.wishlistId)||"none",wishlist:(s==null?void 0:s.wishlist)||null,priority:(s==null?void 0:s.priority)||"1"}}),{errors:c}=r.formState,x=s?"Редактировать желание":"Новое желание",d=l=>R(null,null,function*(){yield n(l,s==null?void 0:s.$id),t(!1)}),o=()=>R(null,null,function*(){var m;t(!1);const{ok:l}=yield a.deleteW(s.$id);if(!l){Z("Не удалось удалить желание");return}ee("Желание удалено",s.title,(m=s.imageURL)!=null?m:void 0),i(se(te.WISHES,{userId:s.ownerId}))}),i=I();return e.jsx(D,p(u({},r),{children:e.jsxs("form",{onSubmit:r.handleSubmit(d),className:"flex flex-col gap-4 md:gap-6 mt-3 md:mt-0 md:ml-4 px-2 md:px-0 pb-2 max-w-3xl",children:[e.jsx("p",{className:"hidden md:block font-headers font-bold text-lg md:text-2xl lg:text-3xl",children:x}),e.jsx(f,{control:r.control,name:"title",render:({field:l})=>e.jsxs(h,{children:[e.jsxs(v,{className:"gap-1",htmlFor:"title",children:["Название ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(U,{children:e.jsx(C,p(u({},l),{className:"text-sm md:text-base",id:"title"}))}),e.jsx(F,{})]})}),e.jsx(f,{control:r.control,name:"description",render:({field:l})=>e.jsxs(h,{children:[e.jsx(v,{htmlFor:"description",children:"Описание"}),e.jsx(U,{children:e.jsx(Y,p(u({id:"description"},l),{className:"h-24 md:h-28 text-sm md:text-base resize-none",placeholder:"Добавьте описание или примечание к желанию"}))}),e.jsx(F,{})]})}),e.jsx(f,{control:r.control,name:"priority",render:({field:l})=>e.jsxs(h,{children:[e.jsx(v,{htmlFor:void 0,children:"Приоритет"}),e.jsx(Re,{setPriority:m=>l.onChange(String(m)),priority:Number(l.value)})]})}),e.jsx(f,{control:r.control,name:"shopURL",render:({field:l})=>e.jsxs(h,{children:[e.jsx(v,{htmlFor:"shopURL",children:"Ссылка на магазин"}),e.jsx(U,{children:e.jsx(C,p(u({},l),{className:"w-full text-sm md:text-base",placeholder:"https://",id:"shopURL"}))}),e.jsx(F,{})]})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(v,{htmlFor:"price",children:"Цена"}),e.jsxs("div",{className:"flex justify-between items-center gap-1 bg-secondary pr-2 focus-within:border-ring rounded-md focus-within:ring-[3px] focus-within:ring-ring/50 md:w-fit",children:[e.jsx(f,{control:r.control,name:"price",render:({field:l})=>{var m;return e.jsx(h,{children:e.jsx(U,{children:e.jsx(ge,{id:"price",getInputRef:l.ref,className:"focus-visible:border-0 focus-visible:ring-0 text-sm md:text-base",thousandSeparator:" ",decimalScale:0,allowNegative:!1,placeholder:"0",value:(m=l.value)!=null?m:"",customInput:C,onValueChange:y=>{var S;l.onChange((S=y.floatValue)!=null?S:null)}})})})}}),e.jsx(f,{control:r.control,name:"currency",render:({field:l})=>e.jsx(h,{children:e.jsx(ke,{onValueChange:l.onChange,value:l.value})})})]}),e.jsxs(F,{children:[c.price&&c.price.message,c.currency&&c.currency.message]})]}),!(s!=null&&s.isArchived)&&e.jsx(f,{control:r.control,name:"wishlistId",render:({field:l})=>e.jsxs(h,{children:[e.jsx(v,{className:"mb-1",htmlFor:void 0,children:"Выберите вишлист"}),e.jsx(ye,{selectedValue:l.value,onSelect:(m,y)=>{r.setValue("wishlistId",m),r.setValue("wishlist",y)},className:"py-6 pl-2 w-full md:w-[24rem] text-sm md:text-base"}),e.jsx(F,{})]})}),e.jsxs("div",{className:"flex sm:flex-row flex-col sm:justify-between gap-2 mt-2 lg:mt-8 w-full",children:[e.jsx(K,{text:"Сохранить",loaderText:"Сохранение...",isSubmitting:r.formState.isSubmitting}),s&&e.jsx(Q,{variant:"button",wishTitle:s.title,action:o,buttonText:"Удалить желание"})]})]})}))}function Le({storageURL:s,setCompressedImage:n}){const[t,a]=j.useState(null),[r,c]=j.useState(0),[x,d]=j.useState(null);j.useEffect(()=>{s&&a(s)},[s]),j.useEffect(()=>()=>{t!=null&&t.startsWith("blob:")&&URL.revokeObjectURL(t)},[t]);const o=j.useCallback(b=>R(null,null,function*(){const k=b[0];if(k){c(0),d(null),t!=null&&t.startsWith("blob:")&&URL.revokeObjectURL(t);try{const N=yield ce(k,{maxSizeMB:1.5,maxWidthOrHeight:1920,useWebWorker:!0,onProgress:O=>c(O)});a(URL.createObjectURL(N)),n==null||n(N)}catch(W){a(URL.createObjectURL(k)),n==null||n(k)}}}),[t,n]),i=j.useCallback(b=>{const W=b[0].errors.map(N=>N.code==="file-invalid-type"?"Неверный формат файла":N.code==="file-too-large"?"Файл слишком тяжелый":N.message);d(W)},[]),{getRootProps:l,getInputProps:m,isDragActive:y}=ie({onDrop:o,onDropRejected:i,maxFiles:1,accept:{"image/jpeg":[".jpg",".jpeg"],"image/png":[".png"],"image/webp":[".webp"]},maxSize:10*1024*1024}),S=r>0&&r<100;return e.jsxs("div",{className:"relative space-y-2 mx-auto md:mx-0 mt-2 md:mt-0",children:[t?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:"icon",className:"-top-1 -right-2 absolute hover:bg-accent shadow-none rounded-full size-8 cursor-pointer",variant:"secondary","aria-label":"Удалить изображение",onClick:()=>{a(null),n(null)},children:e.jsx(ae,{})}),e.jsx("div",{className:"rounded-3xl md:w-full w-3xs max-h-[24rem] md:max-h-[40rem] 2xl:max-h-[52rem] overflow-clip",children:e.jsx("img",{src:t,className:"w-full h-full",alt:"Превью"})})]}):e.jsxs("div",p(u({},l({className:`border-2 border-dashed border-muted-foreground rounded-3xl md:w-full w-3xs md:aspect-[4/3] aspect-[16/6] flex flex-col gap-3 md:gap-8 items-center justify-center ${y||S?"bg-muted":"bg-muted/60"}`})),{children:[S?e.jsx(ne,{className:"size-8 md:size-12 text-muted-foreground animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"stroke-1 size-8 md:size-12 text-muted-foreground"}),e.jsxs("div",{className:"hidden md:block text-muted-foreground text-sm md:text-base text-center",children:[e.jsx("p",{className:"font-bold",children:"JPG, JPEG, PNG, WEBP"}),e.jsx("p",{children:"макс: 10МБ"})]})]}),e.jsx("input",p(u({},m()),{id:"image-dropzone"}))]})),x&&e.jsx("div",{className:re("bg-destructive/30 px-3.5 py-4 rounded-md font-medium text-destructive text-sm"),children:x.map(b=>e.jsxs("p",{className:"inline-flex items-center gap-2 [&_svg]:size-4",children:[e.jsx(de,{}),b]},b))})]})}function Be({wish:s,saveChanges:n,storageImageURL:t}){const[a,r]=j.useState(void 0),[c,x]=j.useState(!0),d=le(({currentLocation:i,nextLocation:l})=>i.pathname!==l.pathname&&c),o=(i,l)=>R(null,null,function*(){const m=a?(yield me(a)).response:t;x(!1),yield n(p(u({},i),{imageURL:m}),l)});return e.jsxs(e.Fragment,{children:[e.jsx(fe,{backSlot:e.jsx(Se,{children:e.jsx(be,{}),variant:"ghost",className:"z-1 absolute md:relative"}),imageSlot:e.jsx(Le,{storageURL:t,setCompressedImage:r}),infoSlot:e.jsx(Fe,{setBlockNavigate:x,wish:s,onSubmit:o})}),d.state==="blocked"&&e.jsx(oe,{title:"Покинуть страницу?",description:e.jsx("p",{children:"Вы точно хотите покинуть эту страницу? Изменения не будут сохранены."}),actionText:"Покинуть",onConfirm:()=>{x(!1),d.proceed()},onCancel:d.reset,open:!0})]})}function Pe(){return e.jsx("div",{className:"space-y-5 lg:space-y-20 mt-0.5 md:mt-5 md:mr-4",children:e.jsxs("div",{className:"flex md:gap-4",children:[e.jsx(g,{className:"w-9 h-9"}),e.jsxs("div",{className:"gap-2 md:gap-8 lg:gap-14 grid grid-cols-1 md:grid-cols-[0.8fr_1fr] mt-1 md:mt-0 w-full",children:[e.jsx(g,{className:"rounded-3xl lg:rounded-[3rem] h-[24rem] md:h-[40rem] 2xl:h-[56rem] aspect-[4/5]"}),e.jsxs("div",{className:"flex flex-col gap-6 lg:gap-10 2xl:gap-12 md:px-0 py-2.5",children:[e.jsx(g,{className:"w-[50%] h-12 shrink-0"}),e.jsxs("div",{className:"flex flex-col gap-4 md:gap-6 mt-3 md:mt-0 md:ml-4 px-2 md:px-0 pb-2 max-w-3xl",children:[e.jsx(g,{className:"w-full h-12"}),e.jsx(g,{className:"w-full h-24 md:h-28"}),e.jsx(g,{className:"w-full md:w-36 h-12"}),e.jsx(g,{className:"w-full h-12"}),e.jsx(g,{className:"w-full md:w-54 h-12"}),e.jsx(g,{className:"w-full md:w-60 h-12"})]})]})]})]})})}export{Pe as W,Be as a,we as n};
