var N=(r,t,s)=>new Promise((o,l)=>{var n=i=>{try{d(s.next(i))}catch(c){l(c)}},a=i=>{try{d(s.throw(i))}catch(c){l(c)}},d=i=>i.done?o(i.value):Promise.resolve(i.value).then(n,a);d((s=s.apply(r,t)).next())});import{r as x,j as e,B as g,z as v,A as b,o as S,D as w,ao as B,m as p,aK as C,aM as R,b6 as H,b7 as L,b8 as y,n as $,N as E,aO as I,M as U,J as A}from"./index-D1Gt8aEI.js";import{u as O,C as W,d as P,h as z,A as k,F as T,B as F,O as D,c as M,a as _}from"./Navigation-DOdjVwpa.js";import{S as q,P as G}from"./ShareOnSocials-CR9GG2Eu.js";import{u as J}from"./useWish-QQtLzbdj.js";import{S as m}from"./react-number-format.es-6ZIK7Ixi.js";import"./schemas-DolQb7Cl.js";import{W as K}from"./WishLayout-B5vCS8_F.js";import"./react-DaZ2_hLt.js";import"./ErrorMessage-D1qwDFst.js";import"./copyLink-NlKa85-9.js";function Q({userId:r,wishId:t}){const{wishes:s,isLoading:o,error:l}=O({ownerId:r,archived:!1,sort:{field:"$sequence",direction:"desc"},filters:[]},"main-wishes",r),n=x.useMemo(()=>s==null?void 0:s.flat().filter(a=>a.$id!==t).slice(0,4),[s,t]);return o?e.jsx("div",{className:"mx-2 md:mx-auto md:max-w-[96%]",children:e.jsx(W,{viewMode:"gallery",children:[...Array(5)].map((a,d)=>e.jsx(m,{className:"mb-4"},"related"+d))})}):l?null:n&&n.length>0?e.jsxs("div",{className:"space-y-3 md:space-y-6 mx-2 md:mx-auto md:max-w-[96%]",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center",children:[e.jsxs("div",{className:"font-headers font-bold text-lg md:text-xl 2xl:text-2xl",children:["Другие желания от @",r]}),e.jsx(g,{variant:"link",className:"has-[>svg]:px-0 text-muted-foreground",asChild:!0,"aria-label":"Смотреть все желания пользователя",children:e.jsxs(v,{to:b(w.WISHES,{userId:r}),children:["все ",e.jsx(S,{})]})})]}),e.jsx(W,{viewMode:"gallery",children:n.map(a=>{var d;return e.jsx("div",{className:"group-card-wrapper transition-all duration-300",children:e.jsx(v,{to:b(w.WISH,{wishId:a.$id,userId:a.ownerId}),state:{data:{userName:a.owner.userName,userId:a.owner.userId,wishTitle:a.title,wlTitle:(d=a.wishlist)==null?void 0:d.title}},children:e.jsxs("div",{className:"flex flex-col gap-1 mb-4",children:[e.jsx(B,{wishId:a.$id,url:a.imageURL,alt:a.title,variant:"gallery"}),e.jsx("div",{className:"font-medium text-sm",children:a.title})]})})},a.$id)})})]}):null}function V({text:r,lines:t=5,buttonTextSize:s="text-sm",className:o}){const[l,n]=x.useState(!1),[a,d]=x.useState(!1),i=x.useRef(null),c=x.useRef(null);x.useEffect(()=>{if(i.current&&c.current){const u=i.current.scrollHeight,f=parseFloat(getComputedStyle(i.current).lineHeight)*t;d(u>f),l?c.current.style.height=`${u}px`:c.current.style.height=`${u>f?f:u}px`}},[l,r,t]);const h=()=>{if(!c.current||!i.current)return;const u=i.current.scrollHeight,f=parseFloat(getComputedStyle(i.current).lineHeight)*t;c.current.style.height=l?`${f}px`:`${u}px`,n(!l)};return e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{ref:c,className:"overflow-hidden transition-[height] duration-300 ease-in-out",children:e.jsx("div",{ref:i,className:p("text-sm",!l&&a&&"text-mask",o),children:r})}),a&&e.jsx("button",{type:"button",onClick:h,className:p("font-medium text-muted-foreground text-sm cursor-pointer",s),"aria-label":l?"свернуть описание":"показать больше",children:l?"- скрыть":"+ показать больше"})]})}const X=x.memo(function({wish:t,roles:s}){const l=[{header:"вишлист",element:(!!t.wishlist||!!(s!=null&&s.isWishOwner))&&!t.isArchived&&e.jsx(P,{wish:t,roles:s,variant:"table",wishlist:t.wishlist})},{header:"приоритет",element:e.jsx(C,{priority:t.priority})},{header:"магазин",element:t.shopURL&&e.jsx(R,{shopURL:t.shopURL,size:"md"})}];return e.jsxs("div",{className:"flex flex-col gap-6 lg:gap-10 2xl:gap-12 max-w-3xl",children:[e.jsx("div",{className:"flex flex-col justify-between gap-2 md:gap-2.5 bg-background text-xs md:text-sm",children:l.map(n=>e.jsxs("div",{className:"flex justify-between items-center gap-1 md:gap-4 md:basis-0",children:[e.jsx("p",{className:"text-muted-foreground/80 shrink-0",children:n.header}),e.jsx("div",{className:"border-b-1 border-b-muted-foreground/50 border-dotted w-full h-1"}),n.element?n.element:e.jsx("p",{className:"py-1 text-muted-foreground/50",children:"нет"})]},n.header))}),t.description&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"font-bold text-lg md:text-xl 2xl:text-2xl",children:"О желании"}),e.jsx(V,{text:t.description,className:"text-sm"})]})]})});function Y({wishId:r,variant:t="button",isArchived:s,wishTitle:o,imageURL:l,className:n}){const{openConfDialog:a}=H(),{archiveWish:d}=z(r),i=()=>a({action:"archive",onConfirm:()=>N(null,null,function*(){const{ok:j}=yield d(s);if(!j){$("Не удалось переместить в архив");return}E(s?"Восстановлено":"Перенесено в архив",o,l)}),name:o,isActive:s}),c=s?"Вернуть из архива":"Переместить в архив",h=e.jsx(L,{tooltipText:c,children:e.jsx(g,{onClick:i,variant:"secondary",size:"icon",className:p(n),"aria-label":c,children:s?e.jsx(k,{}):e.jsx(y,{})})}),u=e.jsxs(g,{variant:s?"secondary":"default",onClick:i,size:"lg",className:p("shadow-none",n),"aria-label":c,children:[s?e.jsx(k,{}):e.jsx(y,{}),c]});return t==="button"?u:h}const Z=x.memo(function({wish:t,roles:s}){var h;const{price:o,currency:l,title:n,imageURL:a,$id:d,isArchived:i,isBooked:c}=t;return e.jsxs("div",{className:"flex md:flex-row flex-col md:justify-between items-start md:items-center gap-4 md:gap-10 md:mt-auto max-w-3xl",children:[o&&e.jsx(T,{price:o,currency:l,className:"font-bold text-2xl lg:text-3xl"}),s.isWishOwner?e.jsx(Y,{imageURL:a!=null?a:void 0,wishId:d,variant:"button",wishTitle:n,isArchived:i,className:"w-full md:w-fit h-14"}):e.jsx(F,{imageURL:a!=null?a:void 0,wishTitle:n,wishId:d,triggerVariant:"page",isBooked:c,isBookedByCurrentUser:(h=s==null?void 0:s.isBooker)!=null?h:!1,className:"w-full md:w-fit h-14"})]})}),ee=x.memo(function({title:t,owner:s,isEditor:o,editWish:l,imageURL:n}){return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-baseline gap-4",children:[e.jsx("p",{className:"font-headers font-bold text-xl md:text-2xl lg:text-3xl 2xl:text-4xl",children:t}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(q,{media:n}),o&&e.jsx(g,{size:"icon",variant:"secondary",onClick:l,"aria-label":"Редактировать желание",children:e.jsx(I,{})})]})]}),e.jsx(D,{userId:s.userId,userName:s.userName,avatarURL:s.avatarURL,className:"mt-0 font-semibold text-sm md:text-base",size:"md"})]})}),se=x.memo(function({wish:t,roles:s}){var l;const{onEditWish:o}=M(t);return e.jsxs("div",{className:"flex flex-col gap-6 lg:gap-10 2xl:gap-12 px-2 md:px-0 py-2.5",children:[e.jsx(ee,{title:t.title,owner:t.owner,editWish:o,isEditor:s==null?void 0:s.isWishOwner,imageURL:(l=t.imageURL)!=null?l:void 0}),e.jsx(X,{wish:t,roles:s}),e.jsx(Z,{wish:t,roles:s})]})});function te(){return e.jsx("div",{className:"space-y-5 lg:space-y-20 mt-0.5 md:mt-5 md:mr-4",children:e.jsxs("div",{className:"flex md:gap-4",children:[e.jsx(m,{className:"w-9 h-9"}),e.jsxs("div",{className:"gap-2 md:gap-8 lg:gap-14 grid grid-cols-1 md:grid-cols-[0.8fr_1fr] mt-1 md:mt-0 w-full",children:[e.jsx(m,{className:"rounded-3xl lg:rounded-[3rem] h-[24rem] md:h-[40rem] 2xl:h-[56rem] aspect-[4/5]"}),e.jsxs("div",{className:"flex flex-col gap-6 lg:gap-10 2xl:gap-12 px-2 md:px-0 py-2.5",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex justify-between items-baseline gap-4",children:[e.jsx(m,{className:"w-full h-12 shrink-0"}),e.jsx(m,{className:"w-9 h-9 shrink-0"})]}),e.jsxs("div",{className:"inline-flex items-center gap-1.5",children:[e.jsx(m,{className:"rounded-full size-8"}),e.jsx(m,{className:"w-24 h-6"})]})]}),e.jsx("div",{className:"flex flex-col justify-between gap-2 md:gap-2.5 text-xs md:text-sm",children:[...Array(3)].map((r,t)=>e.jsxs("div",{className:"flex justify-between items-center gap-1 md:gap-4 md:basis-0",children:[e.jsx(m,{className:"w-24 h-5"}),e.jsx("div",{className:"border-b-1 border-b-muted-foreground/50 border-dotted w-full h-1"}),e.jsx(m,{className:"w-24 h-5"})]},"details"+t))}),e.jsxs("div",{className:"flex md:flex-row flex-col md:justify-between items-start md:items-center gap-4 md:gap-10 md:mt-auto max-w-3xl",children:[e.jsx(m,{className:"w-36 h-12"}),e.jsx(m,{className:"w-full md:w-32 h-14"})]})]})]})]})})}function ae(){const{wishId:r}=U(),{wish:t,isLoading:s,error:o}=J(r!=null?r:null),{userId:l,isLoggedIn:n}=A(),{hasAccess:a,roles:d}=_("wish",t);return e.jsx(G,{item:t,isLoggedIn:n,userId:l,hasAccess:a,isLoading:s,error:o,skeleton:e.jsx(te,{}),children:i=>e.jsx(K,{imageSlot:e.jsx(B,{wishId:i.$id,url:i.imageURL,alt:i.title,isBooked:i.isBooked,variant:"page"}),infoSlot:e.jsx(se,{wish:i,roles:d}),relatedSlot:e.jsx(Q,{userId:i.owner.userId,userName:i.owner.userName,wishId:i.$id})})})}const fe=ae;export{fe as Component};
