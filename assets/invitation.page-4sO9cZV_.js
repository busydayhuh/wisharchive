var x=(n,r,s)=>new Promise((d,t)=>{var i=a=>{try{c(s.next(a))}catch(o){t(o)}},l=a=>{try{c(s.throw(a))}catch(o){t(o)}},c=a=>a.done?d(a.value):Promise.resolve(a.value).then(i,l);c((s=s.apply(n,r)).next())});import{J as I,K as f,r as h,bD as p,A as g,D as N,N as v,h as w,n as C,j as e,ap as b,aq as E,ar as S,as as y,a_ as L,B as A,L as u,bE as R}from"./index-E97AOaNp.js";import{u as T}from"./useWishlist-BMSmyfGl.js";import"./schemas-DolQb7Cl.js";import{E as D}from"./ErrorMessage-CuX5Sa92.js";import{C as j,a as M,b as O,c as P,d as U,e as W}from"./card-CQU7W321.js";import"./react-DaZ2_hLt.js";function k(){const{isLoggedIn:n,initSession:r}=I(),{navigateWithState:s}=f();return h.useCallback((t,i,l,c)=>x(null,null,function*(){try{i(!0),yield p.acceptInvite(t.teamId,t.membershipId,t.userId,t.secret),n||(yield r()),s(g(N.WISHLIST,{userId:l,listId:t.teamId}),{wlTitle:t.teamName}),v("Приглашение принято",t.teamName,c)}catch(a){const{errorMessage:o}=w(a);C("Не удалось принять приглашение",o);return}finally{i(!1)}}),[r,n,s])}function z({params:n,wlImageURL:r,wlTitle:s,wlOwnerId:d,loading:t,onAcceptInvite:i}){return e.jsxs(j,{className:"shadow-none border-0 w-full max-w-2xl",children:[e.jsxs(M,{children:[e.jsx(O,{className:"font-bold text-xl md:text-2xl",children:"Новое приглашение"}),e.jsxs(P,{className:"sr-only",children:["Принять приглашение в команду соавторов списка ",n.teamName]})]}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("p",{children:["Привет, ",e.jsx("strong",{children:n.userId}),"!"]}),e.jsxs("p",{children:["Нажимая кнопку ниже, ты подтверждаешь своё участие в команде соавторов списка ",e.jsxs("strong",{children:["«",n.teamName,"»"]}),"."]}),e.jsxs(b,{variant:"muted",children:[e.jsx(E,{variant:"image",children:e.jsx("img",{src:r,className:"place-content-center grid bg-muted rounded-sm size-8",alt:s[0]})}),e.jsxs(S,{children:[e.jsx(y,{children:e.jsx("span",{className:"font-semibold line-clamp-2",children:s})}),e.jsxs(L,{children:["владелец: @",d]})]})]})]}),e.jsx(W,{children:e.jsxs(A,{onClick:i,className:"h-14",disabled:t,children:[t&&e.jsx(u,{className:"animate-spin"}),t?"Авторизация...":"Принять и перейти к списку"]})})]})}function B(){var o,m;const[n]=R(),r=Object.fromEntries(n),{wishlist:s,isLoading:d,error:t}=T(r.teamId),[i,l]=h.useState(!1),c=((m=(o=s==null?void 0:s.wishes)==null?void 0:o.at(-1))==null?void 0:m.imageURL)||void 0,a=k();if(d)return e.jsx("div",{className:"fixed inset-0 place-content-center grid",children:e.jsx(j,{className:"place-content-center grid shadow-none border-0 w-full md:w-2xl h-56",children:e.jsx(u,{className:"size-9 animate-spin"})})});if(t)return e.jsx(D,{variant:"default"});if(s)return e.jsx("div",{className:"fixed inset-0 place-content-center grid",children:e.jsx(z,{params:r,wlImageURL:c,wlTitle:s.title,wlOwnerId:s.ownerId,loading:i,onAcceptInvite:()=>a(r,l,s.ownerId,c)})})}const Q=B;export{Q as Component};
