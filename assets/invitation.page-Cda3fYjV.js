var m=(n,t,a)=>new Promise((d,s)=>{var i=r=>{try{o(a.next(r))}catch(c){s(c)}},l=r=>{try{o(a.throw(r))}catch(c){s(c)}},o=r=>r.done?d(r.value):Promise.resolve(r.value).then(i,l);o((a=a.apply(n,t)).next())});import{n as j,O as I,r as x,Q as f,o as p,q as w,w as g,T as v,v as N,j as e,U as C,V as b,X as E,Y as S,Z as y,B as L,_ as h}from"./index-CMoUaIAy.js";import{u as R}from"./useWishlist-DkUeEDpu.js";import"./schemas-DolQb7Cl.js";import{E as T}from"./ErrorMessage-DwCpUaXx.js";import{C as u,a as A,b as U,c as O,d as M,e as W}from"./card-BE4tJbKu.js";import"./react-DaZ2_hLt.js";function k(){const{isLoggedIn:n,initSession:t}=j(),{navigateWithState:a}=I();return x.useCallback((s,i,l,o)=>m(null,null,function*(){try{i(!0),yield f.acceptInvite(s.teamId,s.membershipId,s.userId,s.secret),n||(yield t()),window.history.replaceState(null,"",`${window.location.origin}/wisharchive/#`),a(p(w.WISHLIST,{userId:l,listId:s.teamId}),{wlTitle:s.teamName}),g("Приглашение принято",s.teamName,o)}catch(r){const{errorMessage:c}=v(r);N("Не удалось принять приглашение",c);return}finally{i(!1)}}),[t,n,a])}function z({params:n,wlImageURL:t,wlTitle:a,wlOwnerId:d,loading:s,onAcceptInvite:i}){return e.jsxs(u,{className:"shadow-none border-0 w-full max-w-2xl",children:[e.jsxs(A,{children:[e.jsx(U,{className:"font-bold text-xl md:text-2xl",children:"Новое приглашение"}),e.jsxs(O,{className:"sr-only",children:["Принять приглашение в команду соавторов списка ",n.teamName]})]}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("p",{children:["Привет, ",e.jsx("strong",{children:n.userId}),"!"]}),e.jsxs("p",{children:["Нажимая кнопку ниже, ты подтверждаешь своё участие в команде соавторов списка ",e.jsxs("strong",{children:["«",n.teamName,"»"]}),"."]}),e.jsxs(C,{variant:"muted",children:[e.jsx(b,{variant:"image",children:e.jsx("img",{src:t,className:"place-content-center grid bg-muted rounded-sm size-8",alt:a[0]})}),e.jsxs(E,{children:[e.jsx(S,{children:e.jsx("span",{className:"font-semibold line-clamp-2",children:a})}),e.jsxs(y,{children:["владелец: @",d]})]})]})]}),e.jsx(W,{children:e.jsxs(L,{onClick:i,className:"h-14",disabled:s,children:[s&&e.jsx(h,{className:"animate-spin"}),s?"Авторизация...":"Принять и перейти к списку"]})})]})}function B(){var r,c;const n=Object.fromEntries(new URLSearchParams(window.location.search)),{wishlist:t,isLoading:a,error:d}=R(n.teamId),[s,i]=x.useState(!1),l=((c=(r=t==null?void 0:t.wishes)==null?void 0:r.at(-1))==null?void 0:c.imageURL)||void 0,o=k();if(a)return e.jsx("div",{className:"fixed inset-0 place-content-center grid",children:e.jsx(u,{className:"place-content-center grid shadow-none border-0 w-full md:w-2xl h-56",children:e.jsx(h,{className:"size-9 animate-spin"})})});if(d)return e.jsx(T,{variant:"default"});if(t)return e.jsx("div",{className:"fixed inset-0 place-content-center grid",children:e.jsx(z,{params:n,wlImageURL:l,wlTitle:t.title,wlOwnerId:t.ownerId,loading:s,onAcceptInvite:()=>o(n,i,t.ownerId,l)})})}const X=B;export{X as Component};
