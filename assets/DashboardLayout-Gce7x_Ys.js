var es=Object.defineProperty,ss=Object.defineProperties;var ts=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var F=(s,t,a)=>t in s?es(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,y=(s,t)=>{for(var a in t||(t={}))G.call(t,a)&&F(s,a,t[a]);if(P)for(var a of P(t))K.call(t,a)&&F(s,a,t[a]);return s},b=(s,t)=>ss(s,ts(t));var Q=(s,t)=>{var a={};for(var r in s)G.call(s,r)&&t.indexOf(r)<0&&(a[r]=s[r]);if(s!=null&&P)for(var r of P(s))t.indexOf(r)<0&&K.call(s,r)&&(a[r]=s[r]);return a};var R=(s,t,a)=>new Promise((r,i)=>{var l=c=>{try{o(a.next(c))}catch(u){i(u)}},n=c=>{try{o(a.throw(c))}catch(u){i(u)}},o=c=>c.done?r(c.value):Promise.resolve(c.value).then(l,n);o((a=a.apply(s,t)).next())});import{c as v,af as as,ag as rs,G as oe,r as x,n as ce,ah as B,J as I,ai as de,aj as ue,h as is,ak as Y,j as e,al as me,am as xe,an as he,ao as O,ap as fe,aq as pe,ar as ge,as as je,aa as W,at as ls,au as ns,av as os,aw as cs,ax as ds,ay as us,B as S,az as ye,aA as be,aB as ve,aC as we,aD as ke,aE as ms,aF as xs,b as hs,aG as fs,aH as C,m as p,ae as ps,O as Ne,D as j,aI as L,aJ as gs,z as M,aK as Se,aL as Ce,aM as js,aN as ys,aO as bs,a1 as Z,aP as _,ac as vs,aQ as Me,aR as Ie,aS as ws,aT as We,K as Ae,M as ks,aU as Re,W as Ns,aV as Ss,aW as Cs,aX as Ms,aY as Is,aZ as N,d as Ws,U as Le,a_ as As,A as $,a$ as Rs,b0 as Ls,b1 as Ds,b2 as J,b3 as Ps,X as _s,P as $s,x as zs,y as Es,w as Us,p as Ts,b4 as Bs,b5 as Os}from"./index-C1B6Ma5q.js";import{b as Vs,u as Hs,D as De,a as qs,R as Pe,C as _e,c as Fs,W as Gs,d as $e,F as ze,O as V,Q as Ks,B as Qs,e as Ys,T as Ee,f as Zs,g as z,N as Js}from"./Navigation-CmDyj_mS.js";import"./schemas-DolQb7Cl.js";import{E as X}from"./ErrorMessage-DgxmWxSy.js";import{b as Xs,S as f,T as Ue}from"./react-number-format.es-5CVStF0_.js";import{u as H}from"./useWishlist-D_pYuCsq.js";import{f as ee,r as se}from"./ru-DjLZO0yZ.js";import{C as Te}from"./checkbox-D_VknBra.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M17 10V4h-2",key:"zcsr5x"}],["path",{d:"M15 10h4",key:"id2lce"}],["rect",{x:"15",y:"14",width:"4",height:"6",ry:"2",key:"33xykx"}]],st=v("arrow-down-1-0",et);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M15 4h5l-5 6h5",key:"8asdl1"}],["path",{d:"M15 20v-3.5a2.5 2.5 0 0 1 5 0V20",key:"r6l5cz"}],["path",{d:"M20 18h-5",key:"18j1r2"}]],Be=v("arrow-down-z-a",tt);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M11 4h10",key:"1w87gc"}],["path",{d:"M11 8h7",key:"djye34"}],["path",{d:"M11 12h4",key:"q8tih4"}]],rt=v("arrow-down-wide-narrow",at);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M17 10V4h-2",key:"zcsr5x"}],["path",{d:"M15 10h4",key:"id2lce"}],["rect",{x:"15",y:"14",width:"4",height:"6",ry:"2",key:"33xykx"}]],lt=v("arrow-up-1-0",it);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M20 8h-5",key:"1vsyxs"}],["path",{d:"M15 10V6.5a2.5 2.5 0 0 1 5 0V10",key:"ag13bf"}],["path",{d:"M15 14h5l-5 6h5",key:"ur5jdg"}]],Oe=v("arrow-up-a-z",nt);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]],ct=v("arrow-up-narrow-wide",ot);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=[["path",{d:"m14 18 4 4 4-4",key:"1waygx"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M18 14v8",key:"irew45"}],["path",{d:"M21 11.354V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h7.343",key:"bse4f3"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}]],Ve=v("calendar-arrow-down",dt);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=[["path",{d:"m14 18 4-4 4 4",key:"ftkppy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M18 22v-8",key:"su0gjh"}],["path",{d:"M21 11.343V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h9",key:"1exg90"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}]],He=v("calendar-arrow-up",ut);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["path",{d:"M12.338 21.994A10 10 0 1 1 21.925 13.227",key:"1i7shu"}],["path",{d:"M12 6v6l2 1",key:"19cm8n"}],["path",{d:"m14 18 4 4 4-4",key:"1waygx"}],["path",{d:"M18 14v8",key:"irew45"}]],xt=v("clock-arrow-down",mt);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=[["path",{d:"M13.228 21.925A10 10 0 1 1 21.994 12.338",key:"1fzlyi"}],["path",{d:"M12 6v6l1.562.781",key:"1ujuk9"}],["path",{d:"m14 18 4-4 4 4",key:"ftkppy"}],["path",{d:"M18 22v-8",key:"su0gjh"}]],ft=v("clock-arrow-up",ht);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]],gt=v("ghost",pt);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],yt=v("layout-dashboard",jt);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]],vt=v("layout-list",bt);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],qe=v("leaf",wt);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=[["path",{d:"M10 18h4",key:"1ulq68"}],["path",{d:"M11 6H3",key:"1u26ik"}],["path",{d:"M15 6h6",key:"1jlkvy"}],["path",{d:"M18 9V3",key:"xwwp7m"}],["path",{d:"M7 12h8",key:"7a1bxv"}]],Nt=v("list-filter-plus",kt);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M11 12H3",key:"51ecnj"}],["path",{d:"M16 6H3",key:"1wxfjs"}],["path",{d:"M16 18H3",key:"12xzn7"}],["path",{d:"M18 9v6",key:"1twb98"}],["path",{d:"M21 12h-6",key:"bt1uis"}]],Ct=v("list-plus",St);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"8",x2:"16",y1:"15",y2:"15",key:"1xb1d9"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],It=v("meh",Mt);function Wt(s,t,a){const{users:r,isLoading:i,error:l}=as([...t,...a,s]);if(!r)return{collaborators:void 0,collaboratorsById:new Map,isLoading:i,error:l};const n=new Map(t.map(d=>[d,"editors"])),o=new Map(a.map(d=>[d,"readers"])),c=new Map([...n,...o,[s,"owner"]]),u=r.map(d=>({userId:d.userId,userName:d.userName,userEmail:d.userEmail,avatarURL:d.avatarURL,role:c.get(d.userId)})),m=new Map(u.map(d=>[d.userId,d]));return{collaborators:u,collaboratorsById:m,isLoading:i,error:l}}function At(s,t,a){const{update:r}=rs(),{updateSWRCache:i,addToCacheList:l,removeFromCacheList:n}=oe(),{wishlist:o}=H(s);return{toggleBookmark:x.useCallback(u=>R(null,null,function*(){if(!a)return;const m=u,d=m?[...t,a]:[...t].filter(g=>g!==a);if(o){const g=b(y({},o),{bookmarkedBy:d}),w=k=>m?l(k,g):n(k,s);i(`bookmarks+${a}`,w)}const{ok:h}=yield r(s,{bookmarkedBy:d});if(!h){ce("Не удалось добавить в закладки");return}}),[a,t,o,r,s,i,l,n])}}function Rt(s){const{$id:t,ownerId:a,title:r,bookmarkedBy:i}=s,{user:l}=B(a),{userId:n}=I(),o=Vs("wishlist",t,a,{userName:l==null?void 0:l.userName,userId:l==null?void 0:l.userId,wlTitle:r}),{collaborators:c,isLoading:u,error:m}=Wt(s.ownerId,s.editorsIds,s.readersIds),{toggleBookmark:d}=At(t,i!=null?i:[],n),h=!!(n&&(i!=null&&i.includes(n)));return{linkParams:o,isFavorite:h,toggleBookmark:d,collaborators:c,collabsLoading:u,collabsError:m,owner:l}}function Lt(){const s=x.useContext(de);if(!s)throw new Error("useWishPicker must be used inside WishPickerContext");return s}function Dt(s){const{update:t}=Xs(),{mutate:a}=ue(),r=Pt(s),{wishlist:i}=H(s),[l,n]=x.useState([]),o=x.useMemo(()=>l.map(({$id:m})=>m),[l]),c=x.useCallback((m,d)=>n(d?h=>[...h,m]:h=>h.filter(({$id:g})=>g!==m.$id)),[]),u=x.useCallback(m=>R(null,null,function*(){r(m,o,l);try{if((yield Promise.all(o.map(h=>t(h,{wishlist:i,wishlistId:m})))).some(h=>!h.ok))throw new Error("Что-то пошло не так");return{ok:!0}}catch(d){return a("wishlists"),a("wishes"),a(m),is(d)}}),[a,r,o,l,t,i]);return{onPickWish:c,moveWishes:u,pickedIds:o}}function Pt(s){const{updateSWRCache:t}=oe(),{mutate:a}=ue(),{wishlist:r}=H(s);return x.useCallback((l,n,o)=>{const c=d=>d.map(h=>{const g=h.$id===l,w=h.wishes.filter(k=>!n.includes(k.$id));if(g){const k=o.map(A=>b(y({},A),{wishlist:h,wishlistId:h.$id}));return b(y({},h),{wishes:Y([...w,...k])})}return b(y({},h),{wishes:w})}),u=d=>{var w,k;const h=(k=(w=d.wishes)==null?void 0:w.filter(A=>!n.includes(A.$id)))!=null?k:[],g=o.map(A=>b(y({},A),{wishlist:d,wishlistId:d.$id}));return b(y({},d),{wishes:Y([...h,...g])})},m=d=>{const h=d.filter(w=>!n.includes(w.$id)),g=o.map(w=>b(y({},w),{wishlist:r,wishlistId:l}));return[...h,...g]};t("wishlists",c),t(`wishlist+${l}`,m),a(l,d=>d&&u(d),{rollbackOnError:!0,revalidate:!1})},[a,t,r])}function te({wishes:s,error:t,isLoading:a,skeleton:r,wishlistId:i,children:l}){const n=x.useMemo(()=>{var o;return(o=s==null?void 0:s.filter(c=>c.wishlistId!==i))!=null?o:[]},[s,i]);if(a)return r;if(t)return e.jsxs("p",{className:"flex flex-col items-center gap-1 mt-2 md:mt-4 text-muted-foreground text-sm",children:[e.jsx(me,{}),"Не удалось загрузить желания"]});if(s&&n.length===0)return e.jsxs("p",{className:"flex flex-col items-center gap-1 mt-2 md:mt-4 text-muted-foreground text-sm",children:[e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx(xe,{className:"stroke-[1.5px]"}),e.jsx(qe,{className:"size-4"})]}),"Нет желаний"]});if(s)return l(n)}function _t({wishes:s,onPickWish:t}){return e.jsx("div",{className:"w-full h-[calc(100%-3rem)] overflow-y-scroll",children:e.jsx("div",{className:"gap-2.5 grid grid-cols-5",children:s.map(a=>e.jsxs("div",{className:"relative px-1 py-1",children:[e.jsx(Te,{id:a.$id,className:"peer/box top-3 right-3 z-100 absolute rounded-full size-6",onCheckedChange:r=>{t(a,!!r)}}),e.jsx(he,{htmlFor:a.$id,className:"peer-data-[state=checked]/box:[&_.image]:outline-3 peer-data-[state=checked]/box:[&_.image]:outline-foreground",children:e.jsxs("div",{className:"gap-1 grid w-full h-full",children:[e.jsx("div",{className:"rounded-3xl image",children:e.jsx(O,{wishId:a.$id,url:a.imageURL,variant:"gallery"})}),e.jsx("p",{className:"px-1 font-medium text-sm line-clamp-1",children:a.title})]})})]},a.$id))})})}function $t(){return e.jsx("div",{className:"gap-2.5 grid grid-cols-5 w-full h-[calc(100%-3rem)] overflow-scroll",children:[...Array(5)].map((s,t)=>e.jsxs("div",{className:"flex flex-col gap-2 mb-4 md:mb-8",children:[e.jsx(f,{className:"rounded-xl md:rounded-3xl w-full aspect-[4/5]"}),e.jsx(f,{className:"rounded-md w-full h-6"})]},"skeleton"+t))})}function zt({wishes:s,onPickWish:t}){return e.jsx("div",{className:"flex flex-col gap-0.5 overflow-y-scroll",children:s.map(a=>e.jsx("div",{className:"relative px-1 py-1",children:e.jsx(he,{htmlFor:a.$id,className:"rounded-2xl peer-data-[state=checked]/box:outline-2 peer-data-[state=checked]/box:outline-foreground",children:e.jsxs(fe,{className:"py-2 pl-1 w-full",children:[e.jsx(pe,{variant:"image",children:e.jsx(O,{wishId:a.$id,url:a.imageURL,variant:"table"})}),e.jsxs(ge,{className:"flex-row justify-between w-full",children:[e.jsx(je,{children:e.jsx("span",{className:"line-clamp-1",children:a.title})}),e.jsx(Te,{id:a.$id,className:"peer/box ms-auto size-5",onCheckedChange:r=>{t(a,!!r)}})]})]})})},a.$id))})}function Et(){return e.jsx("div",{className:"flex flex-col gap-0.5 overflow-y-scroll",children:[...Array(5)].map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"rounded-sm size-10"}),e.jsx(f,{className:"rounded-md w-full h-6"})]},"skeleton"+t))})}function Ut({pickerOpen:s,setPickerOpen:t,wishlistId:a}){const r=W(),{userId:i}=I(),{wishes:l,isLoading:n,error:o}=Hs({ownerId:i,archived:!1,sort:{field:"$sequence",direction:"desc"},filters:[],limit:100},"main-wishes",i),{onPickWish:c,moveWishes:u,pickedIds:m}=Dt(a),d=m.length===0,h=()=>R(null,null,function*(){const{ok:g}=yield u(a);if(!g){ce("Не удалось перенести желания","Повторите попытку позже");return}hs("Желания перенесены")});return r?e.jsx(ls,{open:s,onOpenChange:t,children:e.jsxs(ns,{children:[e.jsx(os,{children:e.jsx(cs,{children:"Выберите желания"})}),e.jsx(te,{wishlistId:a,wishes:l,isLoading:n,error:o,skeleton:e.jsx(Et,{}),children:g=>e.jsx(zt,{wishes:g,onPickWish:c})}),e.jsx(ds,{children:e.jsx(us,{asChild:!0,children:e.jsx(S,{size:"lg",onClick:h,disabled:d,children:"Перенести"})})})]})}):e.jsx(ye,{open:s,onOpenChange:t,children:e.jsxs(be,{className:"flex flex-col gap-6 min-w-[calc(100%-10rem)] h-[calc(100%-6rem)]",children:[e.jsxs(ve,{children:[e.jsx(we,{children:"Перенести желания в этот список"}),e.jsx(ke,{className:"sr-only",children:"Перенести желания в этот список"})]}),e.jsx(te,{wishlistId:a,wishes:l,isLoading:n,error:o,skeleton:e.jsx($t,{}),children:g=>e.jsx(_t,{wishes:g,onPickWish:c})}),e.jsx(ms,{className:"bottom-2 left-1/2 fixed -translate-x-1/2",children:e.jsx(xs,{asChild:!0,children:e.jsx(S,{size:"xl",onClick:h,disabled:d,children:"Перенести"})})})]})})}function Tt({children:s}){const[t,a]=x.useState(!1),[r,i]=x.useState(""),l=x.useCallback(n=>{n&&(a(!0),i(n))},[a,i]);return e.jsxs(de.Provider,{value:{pickerOpen:t,openPicker:l},children:[s,e.jsx(Ut,{pickerOpen:t,setPickerOpen:a,wishlistId:r})]})}function q(){const s=x.useContext(fs);if(!s)throw new Error("useWishlistDialog должен использоваться только внутри WishlistDialogProvider");return s}function Ha({loadMore:s,disabled:t=!1,offset:a=200}){x.useEffect(()=>{if(t)return;const r=()=>{const i=window.scrollY,l=window.innerHeight,n=document.body.offsetHeight;l+i>=n-a&&s()};return window.addEventListener("scroll",r),()=>window.removeEventListener("scroll",r)},[s,t,a])}function Bt(){const s=x.useContext(De);if(!s)throw new Error("useDashboard must be used inside DashboardLayout");return s}function D(){const s=x.useContext(Ue);if(!s)throw new Error("useToolbar должен использоваться только внутри DashboardToolbarContext");return s}function Ot({type:s,item:t,children:a}){const{hasAccess:r,roles:i}=qs(s,t);return r?e.jsx(Pe.Provider,{value:i,children:a}):null}function Vt({type:s,viewMode:t,children:a}){const r=x.useRef(!1);return x.useEffect(()=>{r.current=!0,requestAnimationFrame(()=>{r.current=!1})},[t]),e.jsx(C.div,{className:p(s==="wish"&&"group-card-wrapper"),layout:!r.current,initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96},transition:{duration:.18},children:a})}function Ht({viewMode:s}){return s==="gallery"?e.jsxs("div",{className:"flex flex-col gap-2 mb-4 md:mb-8",children:[e.jsx(f,{className:"rounded-xl md:rounded-3xl w-full aspect-[4/5]"}),e.jsxs("div",{className:"flex md:flex-row flex-col justify-between md:items-center gap-2",children:[e.jsx(f,{className:"rounded-md w-full h-6"}),e.jsx(f,{className:"rounded-md w-20 h-6 shrink-0"})]})]}):e.jsxs("div",{className:"relative items-center gap-2 grid grid-cols-[3fr_1fr] md:grid-cols-[22rem_1fr_1fr_0.5fr] lg:grid-cols-[28rem_1fr_1fr_1fr_0.5fr] 2xl:grid-cols-[54rem_1fr_1fr_1fr_0.5fr] xl:grid-cols-[40rem_1fr_1fr_1fr_0.5fr] md:px-1 py-1 md:py-2 w-full",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(f,{className:"rounded-md md:rounded-xl size-24 md:size-32 lg:size-40"}),e.jsxs("div",{className:"flex flex-col gap-1 px-4 lg:px-8",children:[e.jsx(f,{className:"w-42 h-6"}),e.jsx(f,{className:"w-20 h-6"})]})]}),e.jsx(f,{className:"hidden md:inline-flex justify-self-center w-28 h-9"}),e.jsx(f,{className:"hidden lg:block justify-self-center w-36 h-5"}),e.jsx(f,{className:"hidden md:block justify-self-end md:justify-self-center w-36 h-9"}),e.jsx(f,{className:"justify-self-end lg:justify-self-center w-9 h-9"})]})}function qt({viewMode:s}){return s==="gallery"?e.jsxs("div",{className:"flex flex-col gap-2 mb-4 md:mb-8",children:[e.jsx(f,{className:"rounded-xl md:rounded-3xl w-full aspect-[4/3]"}),e.jsx(f,{className:"rounded-md w-full h-6"})]}):e.jsxs("div",{className:"wl-table-grid items-center py-2 pl-2 md:pl-0",children:[e.jsx(f,{className:"rounded-sm md:rounded-xl w-[6rem] md:w-[7rem] lg:w-[10rem] aspect-[4/3]"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(f,{className:"w-42 h-6"}),e.jsx(f,{className:"w-20 h-6"})]}),e.jsx(ps,{size:"md",maxVisible:3,className:"hidden sm:flex justify-self-center"}),e.jsxs("div",{className:"hidden lg:flex flex-col justify-center justify-self-center items-center gap-1",children:[e.jsx(f,{className:"w-14 h-5"}),e.jsx(f,{className:"w-20 h-5"})]}),e.jsxs("div",{className:"hidden lg:flex flex-col justify-center justify-self-center items-center gap-1",children:[e.jsx(f,{className:"w-14 h-5"}),e.jsx(f,{className:"w-20 h-5"})]}),e.jsxs("div",{className:"flex justify-end md:justify-evenly items-center",children:[e.jsx(f,{className:"hidden md:inline-flex w-9 h-9"}),e.jsx(f,{className:"w-9 h-9"})]})]})}function Ft({items:s,type:t,isLoading:a,viewMode:r,error:i,children:l}){const{isDashboardOwner:n,dashboardType:o}=Bt(),{hasActiveFilters:c}=D(),{openDialog:u}=q(),m=Ne(),d=["wishes","lists","list"];if(a&&!s)return e.jsx(_e,{viewMode:r,children:[...Array(5)].map((h,g)=>e.jsx(Fe,{viewMode:r,type:t},"item-skeleton-"+g))});if(i)return e.jsx(X,{variant:"default"});if(s&&s.length===0)return e.jsx(X,{variant:c?"no-results":"no-items",entity:t==="wish"?"wishes":"wishlists",withButton:n&&d.includes(o),action:()=>t==="wish"?m(j.ADD):u("create")});if(s)return l(s)}function Fe({type:s,viewMode:t}){return s==="wish"?e.jsx(Ht,{viewMode:t}):e.jsx(qt,{viewMode:t})}function Ge(){const s=x.useContext(Pe);if(!s)throw new Error("useRoles must be used inside RolesContext");return s}function Ke(s){const{linkParams:t,onEditWish:a}=Fs(s),r=Ge(),{page:i}=L(),l=i.list||i.booked,n=W(),{user:o}=B(s.ownerId);return{linkParams:t,onEditWish:a,showOwner:l,onListPage:i.list,onBookedPage:i.booked,userRoles:r,isMobile:n,owner:o}}function Gt({dashboardType:s,localStorageKey:t,children:a}){const[r,i]=gs(t,{sort:{direction:"desc",field:"$sequence"},filters:[],viewMode:"gallery"}),[l,n]=x.useState("");return e.jsx(Ue.Provider,{value:{toolbarState:r,setToolbarState:i,searchString:l,setSearchString:n,dashboardType:s,localStorageKey:t,hasActiveFilters:r.filters.length>0},children:a})}function Kt({wish:s}){const t=Ke(s),{userRoles:a,linkParams:r,showOwner:i,owner:l}=t;return e.jsxs("div",{className:p("relative flex flex-col gap-2 mb-4 md:mb-8 overflow-hidden"),children:[e.jsx(Gs,{wish:s,meta:t}),!s.isArchived&&e.jsx($e,{wish:s,wishlist:s.wishlist,variant:"gallery",roles:a,className:p("top-3 right-3 absolute w-fit font-medium md:text-sm 2xl:text-sm")}),e.jsxs(M,{to:r.to,state:r.state,className:"flex lg:flex-row flex-col lg:justify-between lg:items-center px-1",children:[e.jsx("p",{className:"pr-1 font-medium text-base lg:text-base xl:text-lg truncate",children:s.title}),s.price?e.jsx(ze,{price:s.price,currency:s.currency,className:"text-muted-foreground text-sm lg:text-base"}):e.jsx("p",{className:"text-transparent whitespace-nowrap",children:"₽"})]}),e.jsxs("div",{className:"flex justify-between items-center gap-1",children:[i&&l&&e.jsx(V,{userId:l.userId,userName:l.userName,avatarURL:l.avatarURL,className:"[&_.owner-name]:hidden lg:[&_.owner-name]:inline text-xs md:text-sm"}),e.jsx(Se,{priority:s.priority,size:"sm"})]})]})}function Qt({wish:s}){const t=Ke(s);return e.jsxs("div",{className:p("wish-table-grid relative items-center md:px-1 py-1 md:py-2 w-full transition"),children:[e.jsx(Yt,{wish:s,meta:t}),e.jsx(Zt,{wish:s,meta:t}),e.jsx(Jt,{priority:s.priority}),e.jsx(Xt,{wish:s,meta:t}),e.jsx(ea,{wish:s,meta:t}),e.jsx(sa,{wish:s,meta:t})]})}function Yt({wish:s,meta:t}){var i,l,n;const{linkParams:a,isMobile:r}=t;return e.jsx(M,{to:a.to,state:a.state,className:"group-card-wrapper flex items-center",style:{gridArea:"image"},children:e.jsxs("div",{className:"relative",children:[e.jsx(O,{isPrivate:(l=(i=s.wishlist)==null?void 0:i.isPrivate)!=null?l:!1,withBlur:!t.onListPage,wishId:s.$id,url:s.imageURL,alt:s.title,isBooked:s.isBooked,variant:"table"}),r&&((n=s.wishlist)==null?void 0:n.isPrivate)&&e.jsx("div",{className:"top-2 left-2 absolute flex justify-center items-center bg-pink-bg rounded-full w-6 h-6 overflow-hidden",children:Ce.private})]})})}function Zt({wish:s,meta:t}){const{title:a,price:r,currency:i}=s,{linkParams:l}=t;return e.jsx(M,{to:l.to,state:l.state,style:{gridArea:"title"},children:e.jsxs("div",{className:"flex flex-col gap-1 px-4 lg:px-8",children:[e.jsx("p",{className:"max-w-[40ch] font-semibold text-sm md:text-base line-clamp-2",children:a}),!!r&&e.jsx(ze,{price:r,currency:i,className:"text-muted-foreground text-sm lg:text-base"})]})})}function Jt({priority:s}){return e.jsx("div",{style:{gridArea:"priority"},children:e.jsx(Se,{priority:s,size:"md",className:"hidden md:inline-flex justify-self-center 2xl:text-sm"})})}function Xt({wish:s,meta:t}){const{showOwner:a,owner:r}=t;return e.jsx("div",{className:"hidden lg:flex justify-center",style:{gridArea:"additional"},children:a&&r?e.jsx(V,{userId:r.ownerId,userName:r.userName,avatarURL:r.avatarURL}):s.shopURL&&e.jsx(js,{shopURL:s.shopURL})})}function ea({wish:s,meta:t}){const{userRoles:a}=t;return e.jsx("div",{className:"hidden md:block justify-self-end md:justify-self-center",style:{gridArea:"controls"},children:e.jsx($e,{wish:s,roles:a,className:"w-fit h-9 font-medium text-xs lg:text-sm",wishlist:s.wishlist,variant:"table"})})}function sa({wish:s,meta:t}){var n,o;const{userRoles:a,onEditWish:r}=t,{isWishOwner:i,isBooker:l}=a;return e.jsx("div",{className:"justify-self-end lg:justify-self-center",style:{gridArea:"actions"},children:i?e.jsx(Ks,{imageURL:(n=s.imageURL)!=null?n:void 0,wishId:s.$id,title:s.title,triggerVariant:"table",side:"bottom",align:"end",isArchived:s.isArchived,onEditWish:r}):e.jsx(Qs,{wishId:s.$id,wishTitle:s.title,imageURL:(o=s.imageURL)!=null?o:void 0,isBooked:s.isBooked,isBookedByCurrentUser:l!=null?l:!1,triggerVariant:"table"})})}function Qe(s){const t=Rt(s),a=Ge(),{openDialog:r}=q(),i=()=>r("edit",s,a,t.collaborators),{page:l}=L();return b(y({},t),{userRoles:a,onSharedPage:l.shared,inBookmarks:l.bookmarks,openWishlistEditor:i})}function Ye({isFavorite:s=!1,onPressed:t,className:a,variant:r}){const i=Ys();return e.jsxs(Ee,{className:p("bg-secondary data-[state=on]:bg-primary hover:bg-secondary/80 data-[state=on]:[&_svg]:fill-primary-foreground data-[state=on]:[&_svg]:stroke-primary-foreground px-1 py-1 rounded-sm data-[state=on]:text-primary-foreground hover:text-foreground cursor-pointer shrink-0",(r==="gallery"||r==="table")&&"h-9 w-9",r==="page"&&"h-9 gap-1.5 px-3 has-[>svg]:px-2.5 text-xs md:text-sm",r==="gallery"&&"bg-inactive-bm",a),defaultPressed:s,onPressedChange:l=>i(()=>t(l)),children:[e.jsx(ys,{className:p("transition duration-200",r==="page"&&"size-3")}),r==="page"?s?"В закладках":"В закладки":null]})}function Ze({onClick:s,className:t}){return e.jsx(S,{size:"icon",onClick:s,type:"button",variant:"secondary",className:p("z-10",t),"aria-label":"Редактировать вишлист",children:e.jsx(bs,{})})}function Je({wishes:s,variant:t="gallery"}){let a=Array(3).fill(null);s&&(a=a.map((i,l)=>s[l]?{imageURL:s[l].imageURL,id:s[l].$id}:null));const r=["top-0 left-0","top-1 -left-1","top-2 -left-2"];return t==="gallery"?e.jsx("div",{className:"relative rounded-xl md:rounded-3xl overflow-hidden",children:e.jsx("div",{className:"relative pb-[75%] w-full",children:e.jsx("div",{className:"absolute inset-0 gap-0.5 grid grid-cols-[1.5fr_1fr] grid-rows-2 *:first:row-span-2 transition",children:a.map(i=>i?i.imageURL?e.jsx("img",{src:i.imageURL,className:"w-full h-full object-cover",alt:i.title},i.id+"coverImage"):e.jsx("div",{style:{background:_(i.id)}},i.id+"coverImage"):e.jsx("div",{className:"bg-muted"},Z.unique()))})})}):e.jsx("div",{className:"relative pr-1 pb-2",children:a.reverse().map((i,l)=>e.jsxs("div",{className:p("bg-muted border-1 border-background rounded-sm md:rounded-xl w-[6rem] md:w-[7rem] lg:w-[10rem] aspect-[4/3] overflow-clip",l!==0&&`absolute ${r[l]}`),children:[i&&i.imageURL&&e.jsx("img",{src:i.imageURL,className:"border-0 outline-0 w-full h-full object-cover",style:{background:_(i.id)},alt:i.title},i.id+"coverImage"),i&&!i.imageURL&&e.jsx("div",{className:"w-full h-full",style:{background:_(i.id)}},i.id+"coverImage")]},Z.unique()))})}function ta({wishlist:s}){var d,h,g,w;const{collaborators:t,toggleBookmark:a,isFavorite:r,onSharedPage:i,openWishlistEditor:l,userRoles:n,linkParams:o,inBookmarks:c,owner:u}=Qe(s),m=W();return e.jsxs("div",{className:"group-card-wrapper flex flex-col gap-1 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ye,{isFavorite:r,onPressed:a,className:"top-2 right-2 z-10 absolute"}),((n==null?void 0:n.isWishlistOwner)||(n==null?void 0:n.isEditor))&&!m&&e.jsx(Ze,{onClick:l,className:"right-2 bottom-2 absolute show-actions"}),e.jsxs(M,b(y({},o),{className:"block relative",children:[e.jsx(Je,{wishes:s.wishes}),s.isPrivate&&e.jsx("div",{className:"top-3 left-3 absolute flex justify-center items-center bg-pink-bg shadow-xs rounded-full size-7 overflow-clip text-foreground",children:e.jsx(vs,{className:"size-3"})})]}))]}),e.jsx(M,b(y({},o),{children:e.jsxs("div",{className:"flex justify-between items-center mt-1 px-2",children:[e.jsx("p",{className:"pr-2 max-w-full sm:max-w-[20ch] min-h-6 font-semibold text-base md:text-lg truncate leading-tight",children:s.title}),c?e.jsx(V,{userId:s.ownerId,userName:(d=u==null?void 0:u.userName)!=null?d:"",avatarURL:(h=u==null?void 0:u.avatarURL)!=null?h:null,size:"sm",className:"[&_.owner-name]:hidden"}):t&&e.jsx(Me,{collaborators:t,size:"sm",maxVisible:3,hideOwner:!0})]})})),i?n&&e.jsx(Ie,{roles:n,size:"sm",className:"mx-2"}):e.jsxs("p",{className:"mx-2 text-muted-foreground text-xs",children:[(w=(g=s.wishes)==null?void 0:g.length)!=null?w:0," жел."]})]})}function aa({wishlist:s}){const t=Qe(s);return e.jsxs("div",{className:"wl-table-grid relative items-center py-2 pl-2 lg:pl-0",children:[e.jsx(ra,{wishlist:s,meta:t}),e.jsx(ia,{wishlist:s,meta:t}),e.jsx(la,{meta:t}),e.jsx(na,{wishlist:s}),e.jsx(oa,{meta:t})]})}function ra({wishlist:s,meta:t}){const{linkParams:a}=t;return e.jsxs(M,b(y({},a),{className:"relative",style:{gridArea:"image"},children:[e.jsx(Je,{wishes:s.wishes,variant:"table"}),s.isPrivate&&e.jsx("div",{className:"top-4 left-0 absolute flex justify-center items-center bg-pink-bg rounded-full w-6 md:w-8 h-6 md:h-8 overflow-clip",children:Ce.private})]}))}function ia({wishlist:s,meta:t}){var l,n;const{linkParams:a,onSharedPage:r,userRoles:i}=t;return e.jsx(M,b(y({},a),{style:{gridArea:"title"},children:e.jsxs("div",{className:"flex flex-col gap-1 lg:basis-2xs",children:[e.jsx("div",{className:"flex items-center gap-2 pr-1 font-semibold text-base 2xl:text-lg",children:e.jsx("p",{className:"max-w-[42ch] truncate",children:s.title})}),r?i&&e.jsx(Ie,{roles:i,size:"sm"}):e.jsxs("p",{className:"text-muted-foreground text-xs",children:[(n=(l=s.wishes)==null?void 0:l.length)!=null?n:0," жел."]})]})}))}function la({meta:s}){const{collaborators:t}=s;return e.jsx("div",{className:"hidden sm:flex justify-self-center",style:{gridArea:"collab"},children:t&&e.jsx(Me,{collaborators:t,size:"md",maxVisible:5,className:"mt-1",hideOwner:!0})})}function na({wishlist:s}){const t=x.useMemo(()=>ee(s.$createdAt,"PP",{locale:se}),[s.$createdAt]),a=x.useMemo(()=>ee(s.$updatedAt,"PP",{locale:se}),[s.$updatedAt]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden lg:flex flex-col items-center gap-0.5 text-muted-foreground",style:{gridArea:"created"},children:[e.jsx("p",{className:"bg-muted px-1.5 py-0.5 rounded-lg text-xs",children:"создан"}),e.jsx("p",{className:"text-sm",children:t})]}),e.jsxs("div",{className:"hidden lg:flex flex-col items-center gap-0.5 text-muted-foreground",style:{gridArea:"updated"},children:[e.jsx("p",{className:"bg-muted px-1.5 py-0.5 rounded-lg text-xs",children:"изменён"}),e.jsx("p",{className:"text-sm",children:a})]})]})}function oa({meta:s}){const{userRoles:t,openWishlistEditor:a,isFavorite:r,toggleBookmark:i}=s;return e.jsxs("div",{className:"flex justify-end md:justify-evenly items-center",style:{gridArea:"actions"},children:[((t==null?void 0:t.isWishlistOwner)||(t==null?void 0:t.isEditor))&&e.jsx(Ze,{onClick:a,className:"hidden md:inline-flex"}),e.jsx(Ye,{variant:"table",isFavorite:r,onPressed:i})]})}function qa({items:s,type:t,isLoading:a,error:r,isValidating:i}){const{toolbarState:l}=D(),{viewMode:n}=l;return e.jsx(Ft,{items:s,type:t,isLoading:a,error:r,viewMode:n,children:o=>e.jsxs(_e,{viewMode:n,className:p(a&&"opacity-60"),children:[o.map(c=>e.jsx(Ot,{type:t,item:c,children:e.jsx(Vt,{type:t,viewMode:n,children:e.jsx(ca,{type:t,viewMode:n,item:c})})},c.$id)),i&&e.jsx(Fe,{type:t,viewMode:n})]},n)})}function ca({type:s,viewMode:t,item:a}){return s==="wish"?t==="gallery"?e.jsx(Kt,{wish:a}):e.jsx(Qt,{wish:a}):t==="gallery"?e.jsx(ta,{wishlist:a}):e.jsx(aa,{wishlist:a})}const da={[j.BOOKED]:"booked",[j.ARCHIVED]:"archived",[j.SHARED]:"shared",[j.BOOKMARKS]:"bookmarks",[j.DASHBOARD]:"wishes",[j.WISHES]:"wishes",[j.WISHLISTS]:"lists",[j.WISHLIST]:"list"};function ua(){const{pathname:s}=ws(),t=x.useCallback(()=>{var i,l;return(l=(i=Object.entries(da).find(([n])=>We({path:n,end:!0},s)))==null?void 0:i[1])!=null?l:"wishes"},[s]),[a,r]=x.useState(()=>t());return x.useEffect(()=>r(t()),[r,t,s]),{dashboardType:a}}const ma={[j.BOOKED]:"Хочу подарить",[j.ARCHIVED]:"Архив желаний",[j.SHARED]:"Совместные списки",[j.BOOKMARKS]:"Закладки",[j.WISHES]:"Мои желания",[j.WISHLISTS]:"Мои списки"};function xa(){var m,d;const{userId:s}=I(),{location:t,params:a}=Ae(),{userId:r,listId:i}=a,l=x.useMemo(()=>r||s,[r,s]),n=l?s===l:!1,o=(d=(m=Object.entries(ma).find(([h])=>We({path:h,end:!0},t.pathname)))==null?void 0:m[1])!=null?d:"Мой дашборд",{dashboardType:c}=ua(),u=x.useMemo(()=>{const h=r||i||null;return h?`${c}+${h}`:c},[c,i,r]);return{dashboardOwnerId:l,isDashboardOwner:n,dashboardHeader:o,dashboardType:c,localStorageKey:u}}const ha={closed:{scale:1},open:{scale:.95,transition:{stiffness:300,damping:18}}},fa={closed:{opacity:0,y:10},open:{opacity:1,y:0,transition:{staggerChildren:.1,delayChildren:.05,staggerDirection:-1}}},pa={closed:{opacity:0,scale:.7,y:6},open:{opacity:1,scale:1,y:0,transition:{bounce:.45,stiffness:300,damping:14}},exit:{opacity:0,scale:.7,y:6,transition:{duration:.12}}};function ga(){const[s,t]=x.useState(!1),{openDialog:a}=q(),{openPicker:r}=Lt(),i=Ne(),{listId:l}=ks(),{page:n}=L(),o=x.useRef(null);return x.useEffect(()=>{if(!s)return;const c=u=>{o.current&&(o.current.contains(u.target)||t(!1))};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[s]),e.jsxs("div",{ref:o,className:"right-3 md:right-[50%] bottom-8 z-20 fixed flex flex-col justify-center items-end md:items-center gap-3 md:translate-x-[50%]",children:[e.jsx(Re,{children:s&&e.jsxs(C.div,{variants:fa,initial:"closed",animate:"open",exit:"closed",className:"flex flex-col items-end md:items-center gap-1.5",children:[e.jsx(E,{icon:e.jsx(Ns,{}),label:"Новое желание",onClick:()=>{i(j.ADD),t(!1)}}),n.list?e.jsx(E,{icon:e.jsx(Ss,{}),label:"Из моих желаний",onClick:()=>{r(l),t(!1)}}):e.jsx(E,{icon:e.jsx(Ct,{}),label:"Новый список",onClick:()=>{a("create"),t(!1)}})]})}),e.jsxs(C.button,{"aria-label":"Создать",onClick:()=>t(c=>!c),variants:ha,animate:s?"open":"closed",whileTap:{scale:.9},className:"relative flex justify-center items-center",children:[e.jsx(C.div,{animate:{rotate:s?45:0},transition:{type:"spring",stiffness:250,damping:16},className:"z-10 absolute stroke-[1.5px] text-background",children:e.jsx(Cs,{className:"size-5"})}),e.jsx(C.div,{animate:{scale:s?.85:1},transition:{type:"spring",bounce:.4},className:p("flex justify-center items-center size-14 gradient-btn"),children:e.jsx(C.div,{animate:{scale:s?1.05:1},className:"fab-shadow blur-lg [@supports(-webkit-backdrop-filter:blur(1px))]:blur-none rounded-full size-14 gradient-btn"})})]})]})}function E({icon:s,label:t,onClick:a}){return e.jsx(C.div,{variants:pa,whileHover:{scale:1.05},whileTap:{scale:.96},children:e.jsxs(S,{onClick:a,className:"gap-2 bg-indigo-bg hover:bg-indigo-bg hover:shadow-indigo-bg/40 hover:shadow-lg has-[>svg]:pr-3.5 rounded-xl h-14 font-normal text-background hover:text-background",children:[s,t]})})}function ja({children:s}){const{isLoggedIn:t}=I();return e.jsx(Tt,{children:e.jsxs("div",{className:"relative pt-3 2xl:pr-2 pb-18",children:[e.jsx(Re,{initial:!1,children:s}),t&&e.jsx(ga,{})]})})}function ya(s,t=500){const[a,r]=x.useState(s);return x.useEffect(()=>{const i=setTimeout(()=>{r(s)},t);return()=>{clearTimeout(i)}},[s,t]),a}function ba({category:s,setCategory:t}){const a="text-xs text-muted-foreground font-medium data-[state=on]:bg-primary data-[state=on]:text-primary-foreground cursor-pointer first:pl-2.5 px-2.5 last:pr-2.5 rounded-sm hover:text-foreground h-8";return e.jsxs(Zs,{type:"single",value:s,onValueChange:t,children:[e.jsx(z,{value:"wishes","aria-label":"Поиск в желаниях",className:a,children:"мои желания"}),e.jsx(z,{value:"wishlists","aria-label":"Поиск в списках",className:a,children:"мои списки"}),e.jsx(z,{value:"users","aria-label":"Поиск в пользователях",className:a,children:"пользователи"})]})}function va(s,t){return R(this,null,function*(){return(yield Ws[s].list(t)).documents})}function wa(s){const{userId:t}=I(),a=s.search!==void 0&&t?ka(s,t):null,r=s.search!==void 0&&a?["global",Ms(s),t]:null,{data:i,isLoading:l,error:n}=Is(r,()=>va(s.category,a),{keepPreviousData:!0});return{results:i,isLoading:l,error:n}}function ka(s,t){const a=[];return t?(s.category==="wishes"&&(a.push(N.contains("title",s.search)),a.push(N.equal("isArchived",!1)),a.push(N.equal("ownerId",t))),s.category==="wishlists"&&(a.push(N.contains("title",s.search)),a.push(N.equal("ownerId",t))),s.category==="users"&&a.push(N.or([N.contains("userId",s.search),N.contains("userName",s.search),N.contains("userEmail",s.search)])),a):null}function Na({category:s,item:t}){var a,r,i,l,n,o,c,u,m;if(s==="users")return e.jsx(Le,{size:"md",avatarURL:(a=t.avatarURL)!=null?a:void 0,name:t.userName,id:t.userId});if(s==="wishes")return t.imageURL?e.jsx("img",{src:t.imageURL,alt:((r=t.title)==null?void 0:r[0])||"",className:"flex justify-center items-center bg-muted font-medium"}):e.jsx("div",{className:"flex justify-center items-center bg-muted w-full h-full font-medium",children:((i=t.title)==null?void 0:i[0])||""});if(s==="wishlists")return(n=(l=t.wishes)==null?void 0:l.at(-1))!=null&&n.imageURL?e.jsx("img",{src:(c=(o=t.wishes)==null?void 0:o.at(-1))==null?void 0:c.imageURL,alt:((u=t.title)==null?void 0:u[0])||"",className:"flex justify-center items-center bg-muted font-medium"}):e.jsx("div",{className:"flex justify-center items-center bg-muted w-full h-full font-medium",children:((m=t.title)==null?void 0:m[0])||""})}function Sa({item:s,category:t,isMobile:a,setOpen:r,className:i}){var o;const{navigateWithState:l}=Ae();function n(){t==="wishes"&&l($(j.WISH,{userId:s.ownerId,wishId:s.$id}),{wishTitle:s.title,userId:s.ownerId}),t==="wishlists"&&l($(j.WISHLIST,{userId:s.ownerId,listId:s.$id}),{wlTitle:s.title,userId:s.ownerId}),t==="users"&&l($(j.WISHES,{userId:s.userId})),r(!1)}return e.jsxs(fe,{size:a?"sm":"default",className:p(a&&"px-1 py-2","hover:bg-muted/50 cursor-pointer",i),onClick:n,children:[e.jsx(pe,{variant:"image",children:e.jsx(Na,{item:s,category:t})}),e.jsxs(ge,{children:[e.jsx(je,{children:e.jsx("span",{className:"line-clamp-2",children:s.title||s.userName})}),e.jsx(As,{children:t==="users"?`@${s.userId}`:(o=s.description)!=null?o:""})]})]})}const Ca={default:"p-4 gap-4 ",sm:"py-3 px-4 gap-2.5"};function Ma({category:s,size:t="default"}){return e.jsxs("div",{className:p("flex items-center",Ca[t]),children:[e.jsx(f,{className:p("rounded-sm size-10",s==="users"&&"rounded-full")}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(f,{className:"w-50 max-w-[60%] h-5 shrink-0"}),e.jsx(f,{className:"w-30 max-w-[40%] h-5 shrink-0"})]})]})}function Ia({category:s,searchString:t,isMobile:a,setOpen:r}){const{results:i,isLoading:l,error:n}=wa({category:s,search:t}),o={wishes:"Мои желания",wishlists:"Мои списки желаний",users:"Пользователи"};if(l)return e.jsxs("div",{className:"flex flex-col h-96 max-h-96 overflow-y-scroll",children:[e.jsx(f,{className:"w-36 h-5 shrink-0"}),[...Array(5)].map((c,u)=>e.jsx(Ma,{category:s,size:a?"sm":"default"},"search-loading"+u))]});if(n||!l&&!i)return e.jsxs("p",{className:"flex flex-col items-center gap-1 mt-2 md:mt-4 text-muted-foreground text-sm",children:[e.jsx(me,{}),"Что-то пошло не так. Повторите запрос позже"]});if(i)return e.jsxs("div",{className:"flex flex-col h-96 max-h-96 overflow-y-scroll",children:[e.jsx("p",{className:"inline-flex items-center gap-2 mb-1 font-semibold text-muted-foreground text-xs",children:t?e.jsxs(e.Fragment,{children:["Результаты поиска",e.jsx("span",{className:"bg-muted px-2.5 py-1 rounded-full text-[0.6rem] shrink-0",children:i.length})]}):o[s]}),e.jsxs(Rs,{children:[i.length===0&&e.jsxs("p",{className:"flex flex-col items-center gap-1 mt-2 md:mt-4 text-muted-foreground text-sm",children:[e.jsxs("span",{className:"inline-flex items-center",children:[e.jsx(xe,{className:"stroke-[1.5px]"}),e.jsx(qe,{className:"size-4"})]}),"Нет результатов"]}),i.map(c=>e.jsx(Sa,{item:c,category:s,isMobile:a,setOpen:r,className:p(l&&"opacity-60")},c.$id))]})]})}function ae(){const s=W(),[t,a]=x.useState(!1),[r,i]=x.useState(""),l=ya(r),[n,o]=x.useState("wishes");x.useEffect(()=>{const m=d=>{(d.metaKey||d.ctrlKey)&&d.key==="k"&&(d.preventDefault(),a(h=>!h))};return window.addEventListener("keydown",m),()=>{window.removeEventListener("keydown",m)}},[]);const c=e.jsx(S,{variant:"secondary",size:"icon",className:"ms-auto",children:e.jsx(J,{})}),u=e.jsxs("div",{className:"flex justify-self-end items-center gap-2",children:[e.jsxs(S,{variant:"secondary",className:"justify-between items-center pr-1.5 w-9 md:w-36 h-9 text-muted-foreground/50 text-xs",children:["поиск",e.jsx("span",{className:"bg-muted px-1.5 py-1 rounded-[0.5rem] font-mono font-medium text-[0.6rem] text-muted-foreground",children:"Ctrl+K"})]}),e.jsx(J,{className:"size-3"})]});return e.jsxs(ye,{open:t,onOpenChange:a,children:[e.jsx(Ls,{asChild:!0,children:s?c:u}),e.jsxs(be,{className:p("top-[40%] md:max-w-2xl lg:max-w-3xl 2xl:max-w-5xl"),children:[e.jsxs(ve,{children:[e.jsx(we,{className:"text-lg lg:text-2xl",children:"Поиск по категориям"}),e.jsx(ke,{className:"sr-only",children:"Поиск по категориям"})]}),e.jsx(ba,{category:n,setCategory:o}),e.jsx(Ds,{searchString:r,setSearchString:i,className:"w-full [&_input]:h-12",grow:!1}),e.jsx("div",{className:"h-96",children:e.jsx(Ia,{category:n,searchString:l,isMobile:s,setOpen:a})})]})]})}function re({userId:s,isOwner:t,className:a}){var o,c;const{user:r,isLoading:i,error:l}=B(s),{hasSearchParams:n}=L();if(l)return t?e.jsx("div",{className:"place-content-center grid bg-muted/80 rounded-full size-12",children:e.jsx(It,{className:"text-muted-foreground"})}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"place-content-center grid bg-muted/80 rounded-full size-12",children:e.jsx(gt,{className:"stroke-1 text-muted-foreground"})}),e.jsx("p",{className:"font-semibold text-lg md:text-2xl truncate leading-tight",children:"Пользователь не найден"})]});if(i||!r)return t?e.jsx(f,{className:"rounded-full size-12"}):e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(f,{className:"rounded-full size-12"}),e.jsxs("div",{className:"flex flex-col justify-center items-center gap-1",children:[e.jsx(f,{className:"w-36 h-6"}),e.jsx(f,{className:"w-30 h-6"})]})]});if(r&&!t||n)return e.jsxs("div",{className:p("flex md:flex-col items-start md:items-center gap-3",a),children:[e.jsx(Le,{name:r.userName,id:r.userId,avatarURL:(o=r.avatarURL)!=null?o:void 0,className:"p-0.5 border-1 border-muted/90 shrink-0",size:"xl"}),e.jsxs("div",{className:"flex flex-col md:items-center gap-1 md:gap-2",children:[e.jsx("p",{className:"font-headers font-bold text-xl md:text-2xl truncate leading-tight",children:r.userName}),e.jsxs("p",{className:"text-muted-foreground text-xs md:text-sm truncate leading-tight",children:["@",r.userId]}),e.jsx("p",{className:"w-full text-muted-foreground text-xs md:text-sm leading-tight",children:r.bio})]})]});if(r&&t)return e.jsx(Ps,{name:r.userName,id:r.userId,avatarURL:(c=r.avatarURL)!=null?c:void 0,email:r.userEmail})}function Wa({dashboardHeader:s,dashboardOwnerId:t,isDashboardOwner:a=!0}){const{isLoggedIn:r}=I(),{hasSearchParams:i}=L(),n=!W()||!a;return a&&!i?e.jsxs("div",{className:"flex justify-between items-center gap-4 md:gap-6 mt-1.5 md:mt-4 mb-2.5 md:mb-3 lg:mb-8 w-full",children:[e.jsx("p",{className:"font-headers font-bold text-primary lg:text-[48px] text-3xl md:text-4xl leading-8",children:s}),e.jsxs("div",{className:"flex items-center gap-4 ms-auto",children:[e.jsx(ae,{}),n&&e.jsx(re,{userId:t,isOwner:a})]})]}):e.jsxs("div",{className:p("items-start grid grid-cols-[3fr_1fr] md:grid-cols-3 mt-1.5 md:mt-4 mb-1.5 md:mb-3 lg:mb-8 w-full",!r&&"md:mt-0"),children:[e.jsx("div",{className:"hidden md:block"}),e.jsxs("div",{className:"flex flex-col md:items-center gap-3",children:[e.jsx(re,{userId:t,isOwner:a}),e.jsx(Js,{})]}),e.jsx("div",{className:"flex justify-self-end items-center gap-4",children:r&&e.jsx(ae,{})})]})}const U=[{label:"Сначала новые",field:"$sequence",direction:"desc",default:!0,icon:e.jsx(Ve,{})},{label:"Сначала старые",field:"$sequence",direction:"asc",icon:e.jsx(He,{})},{label:"По названию (А-Я)",field:"title",direction:"asc",icon:e.jsx(Oe,{})},{label:"По названию (Я-А)",field:"title",direction:"desc",icon:e.jsx(Be,{})},{label:"Сначала дешевле",field:"price",direction:"asc",icon:e.jsx(lt,{})},{label:"Сначала дороже",field:"price",direction:"desc",icon:e.jsx(st,{})},{label:"Сначала низкий приоритет",field:"priority",direction:"asc",icon:e.jsx(ct,{})},{label:"Сначала высокий приоритет",field:"priority",direction:"desc",icon:e.jsx(rt,{})}],T=[{label:"Сначала новые",field:"$sequence",direction:"desc",default:!0,icon:e.jsx(Ve,{})},{label:"Сначала старые",field:"$sequence",direction:"asc",icon:e.jsx(He,{})},{label:"По названию (А-Я)",field:"title",direction:"asc",icon:e.jsx(Oe,{})},{label:"По названию (Я-А)",field:"title",direction:"desc",icon:e.jsx(Be,{})},{label:"Недавно обновлённые",field:"$updatedAt",direction:"desc",icon:e.jsx(xt,{})},{label:"Давно не обновлялись",field:"$updatedAt",direction:"asc",icon:e.jsx(ft,{})}],Xe={wishes:{sorts:U,filters:[{key:"isBooked",value:!1,label:"только свободные"},{key:"priority",value:"2",label:"высокий приоритет"}]},lists:{sorts:T,filters:[{key:"isPrivate",value:!0,label:"только приватные",onlyIfOwner:!0}]},booked:{sorts:U,filters:[{key:"priority",value:"2",label:"высокий приоритет"}]},bookmarks:{sorts:T,filters:[{key:"isPrivate",value:!0,label:"только приватные",onlyIfOwner:!0}]},shared:{sorts:T,filters:[{key:"editorsIds",requiresUser:!0,label:"я редактор"},{key:"readersIds",requiresUser:!0,label:"я читатель"},{key:"ownerId",requiresUser:!0,label:"я владелец"}]},archived:{sorts:[],filters:[]},list:{sorts:U,filters:[{key:"isBooked",value:!1,label:"только свободные"},{key:"priority",value:"2",label:"высокий приоритет"},{key:"ownerId",requiresUser:!0,label:"только мои"}]}};function ie({isOwner:s}){const{toolbarState:t,setToolbarState:a,dashboardType:r}=D(),i=W(),{current:l}=I(),n=x.useMemo(()=>t.filters,[t]),o=x.useMemo(()=>Xe[r].filters,[r]),c=x.useCallback(m=>n.some(d=>d.key===m),[n]),u=x.useMemo(()=>o.length===0?null:o.map(m=>{if(!(!(m.requiresUser&&!l)&&(!m.onlyIfOwner||s)))return null;const h=m.requiresUser&&l?l.$id:m.value;return e.jsx(Aa,{filterKey:m.key,value:h,label:m.label,isPressed:c(m.key),setToolbarState:a},m.label)}).filter(Boolean),[s,c,o,a,l]);return i?e.jsx(Ra,{toggles:u,isActive:n.length>0}):e.jsx("div",{className:"flex gap-2 max-w-xl overflow-x-scroll no-scrollbar",children:u})}function Aa({filterKey:s,value:t,label:a,isPressed:r,setToolbarState:i}){const l=x.useMemo(()=>({key:s,value:t,label:a}),[s,t,a]),n=x.useCallback(o=>{i(c=>b(y({},c),{filters:o?[...c.filters,l]:c.filters.filter(u=>u.key!==l.key)}))},[l,i]);return e.jsxs(Ee,{variant:"default",value:s,pressed:r,onPressedChange:n,className:p("items-center bg-muted/60 data-[state=on]:bg-primary md:bg-transparent hover:bg-muted/60 px-2.5 rounded-md font-normal text-muted-foreground/70 data-[state=on]:text-background hover:text-muted-foreground text-xs lg:text-sm cursor-pointer shrink-0"),children:[a,r&&e.jsx(_s,{className:"size-3"})]})}function Ra({toggles:s,isActive:t}){return e.jsxs($s,{children:[e.jsx(zs,{asChild:!0,children:e.jsx(S,{size:"icon",variant:t?"default":"ghost",className:p(t&&"relative has-active-filter"),children:e.jsx(Nt,{})})}),e.jsx(Es,{className:"flex flex-wrap items-center gap-1.5 bg-secondary w-3xs shrink-0",children:s})]})}function le(){const{toolbarState:s,setToolbarState:t,dashboardType:a}=D(),r=s.sort,i=Xe[a].sorts.map(n=>({value:`${n.field}+${n.direction}`,label:n.label,icon:n.icon}));function l(n){const o=n.split("+"),c={field:o[0],direction:o[1]};t(u=>b(y({},u),{sort:c}))}return e.jsx(Us,{selectedValue:`${r.field}+${r.direction}`,onSelect:l,options:i,renderSelected:n=>e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[n==null?void 0:n.icon,n==null?void 0:n.label]}),e.jsx(Ts,{className:"md:hidden size-3"})]}),triggerClassName:p("gap-2 bg-primary px-2.5 w-fit max-w-[16rem] h-9 md:data-[size=default]:h-10 text-primary-foreground text-xs lg:text-sm"),title:"Сортировка"})}const La=Bs("flex w-fit items-stretch [&>*]:focus-visible:z-10 [&>*]:focus-visible:relative [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md has-[>[data-slot=button-group]]:gap-2",{variants:{orientation:{horizontal:"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none",vertical:"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none"}},defaultVariants:{orientation:"horizontal"}});function Da(r){var i=r,{className:s,orientation:t}=i,a=Q(i,["className","orientation"]);return e.jsx("div",y({role:"group","data-slot":"button-group","data-orientation":t,className:p(La({orientation:t}),s)},a))}function ne({setViewMode:s,viewMode:t,className:a}){const r="cursor-pointer rounded-sm first:rounded-l-sm last:rounded-r-sm text-muted-foreground hover:bg-muted/80 bg-muted",i="bg-primary text-background hover:bg-primary";return e.jsxs(Da,{"aria-label":"View mode",orientation:"horizontal",children:[e.jsx(S,{size:"icon",className:p(r,t==="gallery"&&i,a),onClick:()=>s("gallery"),children:e.jsx(yt,{})}),e.jsx(S,{size:"icon",className:p(r,t==="table"&&i,a),onClick:()=>s("table"),children:e.jsx(vt,{})})]})}function Pa({isOwner:s}){const t=W(),a=Os(j.ARCHIVED),{toolbarState:r,setToolbarState:i}=D();return t?e.jsxs("div",{className:"top-0 z-20 sticky flex justify-between gap-2 bg-background py-2 w-full",children:[!a&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(le,{}),e.jsx(ie,{isOwner:s})]}),e.jsx(ne,{viewMode:r.viewMode,setViewMode:l=>i(n=>b(y({},n),{viewMode:l})),className:"ms-auto"})]}):e.jsxs("div",{className:"flex justify-between items-center gap-2 mr-6 px-1.5 py-2 w-full",children:[!a&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{}),e.jsx(ie,{isOwner:s})]}),e.jsx(ne,{viewMode:r.viewMode,setViewMode:l=>i(n=>b(y({},n),{viewMode:l})),className:"ms-auto"})]})}function Fa({header:s,children:t}){const a=xa();return e.jsx(De.Provider,{value:a,children:e.jsx(Gt,{dashboardType:a.dashboardType,localStorageKey:a.localStorageKey,children:e.jsxs("div",{className:"relative space-y-2 md:space-y-0 mt-2 px-1 md:px-0",children:[s||e.jsx(Wa,y({},a)),e.jsx(Pa,{isOwner:a.isDashboardOwner}),e.jsx(ja,{children:t})]})},a.dashboardType)})}export{Ye as B,qa as C,Fa as D,Ze as E,Gt as T,Ht as W,D as a,Ha as b,Rt as c,q as d,Bt as u};
